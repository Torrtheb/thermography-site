{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
{# --- Page Header --- #}
<section class="bg-brand-50 py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center" data-aos="fade-up">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
            {{ page.title }}
        </h1>
        {% if page.intro %}
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            {{ page.intro }}
        </p>
        {% endif %}
    </div>
</section>

{# --- Section Navigation Tabs --- #}
{% if sections %}
<section class="border-b border-gray-200 bg-white sticky top-16 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <nav class="flex items-center gap-1 overflow-x-auto py-1 -mb-px" aria-label="Resource sections">
            <a href="{% pageurl page %}"
               class="px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 transition
                      {% if not active_category %}border-brand-600 text-brand-700{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %}">
                All
            </a>
            {% for slug, label in categories %}
            <a href="{% pageurl page %}?category={{ slug }}"
               class="px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 transition
                      {% if active_category == slug %}border-brand-600 text-brand-700{% else %}border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300{% endif %}">
                {{ label }}
            </a>
            {% endfor %}
        </nav>
    </div>
</section>
{% endif %}

{# --- Content Area --- #}
<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

{% if active_category %}
    {# --- Filtered View: showing one category --- #}
    {% if posts %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for post in posts %}
        {% include "blog/includes/post_card.html" with post=post %}
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-500 text-lg py-8">
        No articles in this section yet — check back soon!
    </p>
    {% endif %}

{% else %}
    {# --- All View: grouped by section --- #}
    {% for section in sections %}
    <div class="{% if not forloop.first %}mt-16 pt-16 border-t border-gray-200{% endif %}" id="{{ section.slug }}">
        <h2 class="text-2xl font-bold text-gray-900 mb-8" data-aos="fade-up">
            {{ section.label }}
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for post in section.posts %}
            {% include "blog/includes/post_card.html" with post=post %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    {% if not sections %}
    <p class="text-center text-gray-500 text-lg">
        Articles coming soon — check back shortly!
    </p>
    {% endif %}
{% endif %}

</section>
{% endblock %}
