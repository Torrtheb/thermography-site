{% load static %}

<nav class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">

            {# --- Logo / Business Name --- #}
            <div class="flex-shrink-0">
                <a href="/" class="flex items-center gap-3 hover:opacity-90 transition">
                    <img src="{% static 'images/logo.png' %}"
                         alt="{{ settings.home.SiteSettings.business_name }} logo"
                         class="h-10 w-auto">
                    <span class="text-xl font-bold text-brand-700 hidden sm:inline">
                        {{ settings.home.SiteSettings.business_name }}
                    </span>
                </a>
            </div>

            {# --- Desktop Navigation Links --- #}
            <div class="hidden lg:flex lg:items-center lg:space-x-8">
                <a href="/services/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium">
                    Services
                </a>
                <a href="/about/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium">
                    About Us
                </a>

                {# --- Resources Dropdown --- #}
                <div class="relative" id="resources-dropdown">
                    <button type="button" id="resources-toggle"
                            class="text-gray-600 hover:text-brand-600 transition font-medium inline-flex items-center gap-1 focus:outline-none">
                        Resources
                        <svg class="w-4 h-4 transition-transform" id="resources-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                        </svg>
                    </button>
                    <div id="resources-menu"
                         class="hidden absolute left-1/2 -translate-x-1/2 top-full mt-2 w-56 bg-white border border-gray-200 rounded-xl shadow-lg py-2 z-50">
                        <a href="/resources/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-brand-50 hover:text-brand-600 font-medium transition">
                            All Resources
                        </a>
                        <hr class="my-1 border-gray-100">
                        <a href="/resources/?category=what-is-thermography" class="block px-4 py-2 text-sm text-gray-600 hover:bg-brand-50 hover:text-brand-600 transition">
                            What is Thermography?
                        </a>
                        <a href="/resources/?category=articles" class="block px-4 py-2 text-sm text-gray-600 hover:bg-brand-50 hover:text-brand-600 transition">
                            Articles
                        </a>
                    </div>
                </div>
                <a href="/faq/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium">
                    FAQ
                </a>
                <a href="/contact/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium">
                    Contact
                </a>

                {# --- Search Toggle --- #}
                <button id="search-toggle" aria-label="Search"
                        class="text-gray-600 hover:text-brand-600 transition focus:outline-none">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                </button>

                <a href="/booking/"
                   class="bg-brand-600 text-white px-5 py-2 rounded-lg hover:bg-brand-700 transition font-medium">
                    Book Now
                </a>
            </div>

            {# --- Mobile Hamburger Button --- #}
            <div class="lg:hidden">
                <button id="mobile-menu-button" aria-label="Open menu" class="text-gray-600 hover:text-brand-600 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    {# --- Mobile Sidebar Overlay (hidden by default) --- #}
    {# Dark backdrop — covers the page behind the sidebar #}
    <div id="mobile-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" aria-hidden="true"></div>

    {# Sidebar panel — slides in from the right #}
    <div id="mobile-menu" class="fixed top-0 right-0 h-full w-72 bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
        {# Close button #}
        <div class="flex justify-end p-4">
            <button id="mobile-menu-close" aria-label="Close menu" class="text-gray-600 hover:text-brand-600 focus:outline-none">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        {# Sidebar links #}
        <div class="px-6 py-4 space-y-4">
            {# Mobile search bar #}
            <form action="/search/" method="get" class="relative mb-2">
                <input type="text" name="query" placeholder="Search…"
                       class="w-full border border-gray-300 rounded-lg pl-10 pr-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
            </form>
            <a href="/services/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">Services</a>
            <a href="/about/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">About Us</a>

            {# Mobile Resources expandable #}
            <div>
                <button type="button" id="mobile-resources-toggle"
                        class="flex items-center justify-between w-full text-gray-700 hover:text-brand-600 font-medium text-lg py-2 focus:outline-none">
                    Resources
                    <svg class="w-4 h-4 transition-transform" id="mobile-resources-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                </button>
                <div id="mobile-resources-menu" class="hidden pl-4 space-y-2 mt-1">
                    <a href="/resources/" class="block text-gray-600 hover:text-brand-600 text-base py-1">All Resources</a>
                    <a href="/resources/?category=what-is-thermography" class="block text-gray-600 hover:text-brand-600 text-base py-1">What is Thermography?</a>
                    <a href="/resources/?category=articles" class="block text-gray-600 hover:text-brand-600 text-base py-1">Articles</a>
                </div>
            </div>
            <a href="/faq/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">FAQ</a>
            <a href="/contact/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">Contact</a>
            <a href="/booking/" class="block bg-brand-600 text-white text-center px-5 py-3 rounded-lg hover:bg-brand-700 font-medium text-lg mt-4">Book Now</a>
        </div>
    </div>

    {# --- Desktop Search Bar (slides down below navbar) --- #}
    <div id="search-bar" class="hidden bg-white border-t border-gray-100 shadow-md">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <form action="/search/" method="get" class="relative">
                <input type="text" name="query" id="search-input" placeholder="Search services, FAQs, articles…"
                       autocomplete="off"
                       class="w-full border border-gray-300 rounded-lg pl-10 pr-12 py-3 text-gray-700 text-lg
                              focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                <button type="button" id="search-close" aria-label="Close search"
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </form>
        </div>
    </div>
</nav>

{# --- Search Toggle Script --- #}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const toggle = document.getElementById('search-toggle');
    const bar = document.getElementById('search-bar');
    const input = document.getElementById('search-input');
    const closeBtn = document.getElementById('search-close');

    if (!toggle || !bar) return;

    toggle.addEventListener('click', function () {
        bar.classList.toggle('hidden');
        if (!bar.classList.contains('hidden')) {
            input.focus();
        }
    });

    closeBtn.addEventListener('click', function () {
        bar.classList.add('hidden');
        input.value = '';
    });

    // Close on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && !bar.classList.contains('hidden')) {
            bar.classList.add('hidden');
            input.value = '';
        }
    });

    // --- Desktop Resources Dropdown ---
    const rToggle = document.getElementById('resources-toggle');
    const rMenu = document.getElementById('resources-menu');
    const rChevron = document.getElementById('resources-chevron');
    const rDropdown = document.getElementById('resources-dropdown');

    if (rToggle && rMenu) {
        rToggle.addEventListener('click', function () {
            rMenu.classList.toggle('hidden');
            rChevron.classList.toggle('rotate-180');
        });
        // Close when clicking outside
        document.addEventListener('click', function (e) {
            if (!rDropdown.contains(e.target)) {
                rMenu.classList.add('hidden');
                rChevron.classList.remove('rotate-180');
            }
        });
        // Close on Escape
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                rMenu.classList.add('hidden');
                rChevron.classList.remove('rotate-180');
            }
        });
    }

    // --- Mobile Resources Expandable ---
    const mToggle = document.getElementById('mobile-resources-toggle');
    const mMenu = document.getElementById('mobile-resources-menu');
    const mChevron = document.getElementById('mobile-resources-chevron');

    if (mToggle && mMenu) {
        mToggle.addEventListener('click', function () {
            mMenu.classList.toggle('hidden');
            mChevron.classList.toggle('rotate-180');
        });
    }
});
</script>