{# Newsletter signup section — included via {% newsletter_signup %} template tag #}
{% load static %}

<section id="newsletter-section" class="bg-gradient-to-br from-brand-700 via-brand-600 to-brand-800 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14">
        <div class="max-w-2xl mx-auto text-center">

            {# --- Icon --- #}
            <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-white/15 mb-5">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25H4.5a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5H4.5a2.25 2.25 0 00-2.25 2.25m19.5 0l-9.75 6.093L2.25 6.75" />
                </svg>
            </div>

            {# --- Heading --- #}
            <h2 class="text-2xl sm:text-3xl font-bold tracking-tight mb-3">
                Stay in the Loop
            </h2>
            <p class="text-brand-100 text-base sm:text-lg leading-relaxed mb-8">
                Get wellness tips, thermography insights, and exclusive offers
                delivered straight to your inbox. No spam — just the good stuff.
            </p>

            {# --- Form --- #}
            <form id="newsletter-form" method="post" action="{% url 'newsletter:subscribe' %}"
                  class="flex flex-col sm:flex-row gap-3 sm:gap-0 max-w-lg mx-auto">
                {% csrf_token %}

                {# Honeypot (hidden from humans) #}
                <div style="position:absolute;left:-9999px;" aria-hidden="true">
                    {{ newsletter_form.website }}
                </div>

                {# Email input #}
                <div class="flex-grow">
                    {{ newsletter_form.email }}
                </div>

                {# Submit button #}
                <button type="submit" id="newsletter-btn"
                        class="px-6 py-3 bg-white text-brand-700 font-semibold rounded-lg sm:rounded-l-none sm:rounded-r-lg
                               hover:bg-brand-50 active:bg-brand-100
                               transition-all duration-200 whitespace-nowrap
                               focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-brand-600">
                    Subscribe
                </button>
            </form>

            {# --- Feedback message (JS fills this) --- #}
            <div id="newsletter-msg" class="mt-4 text-sm font-medium hidden"></div>

            {# --- Privacy note --- #}
            <p class="mt-5 text-xs text-brand-200/70">
                We respect your privacy. Unsubscribe at any time.
            </p>
        </div>
    </div>
</section>

<script>
(function () {
    const form = document.getElementById('newsletter-form');
    const btn = document.getElementById('newsletter-btn');
    const msg = document.getElementById('newsletter-msg');
    if (!form) return;

    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        // Disable while in flight
        btn.disabled = true;
        btn.textContent = 'Sending…';
        msg.classList.add('hidden');

        try {
            const resp = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'X-Requested-With': 'XMLHttpRequest' },
            });
            const data = await resp.json();

            msg.classList.remove('hidden', 'text-red-200', 'text-green-200');
            if (data.ok) {
                msg.classList.add('text-green-200');
                msg.textContent = data.message;
                form.reset();
            } else {
                msg.classList.add('text-red-200');
                msg.textContent = data.error || 'Something went wrong. Please try again.';
            }
        } catch {
            msg.classList.remove('hidden', 'text-green-200');
            msg.classList.add('text-red-200');
            msg.textContent = 'Network error. Please try again.';
        } finally {
            btn.disabled = false;
            btn.textContent = 'Subscribe';
        }
    });
})();
</script>
