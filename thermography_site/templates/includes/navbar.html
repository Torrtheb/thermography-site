{% load static wagtailimages_tags %}

<nav class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-3">

            {# --- Logo + Business Name --- #}
            <div class="flex-shrink-0">
                <a href="/" class="flex items-center gap-2 hover:opacity-90 transition">
                    {% if settings.home.SiteSettings.logo %}
                    {% image settings.home.SiteSettings.logo max-400x400 alt=settings.home.SiteSettings.business_name class="h-16 sm:h-18 lg:h-20 w-auto flex-shrink-0" %}
                    {% else %}
                    <img src="{% static 'images/logo.png' %}"
                         alt="{{ settings.home.SiteSettings.business_name }}"
                         class="h-16 sm:h-18 lg:h-20 w-auto flex-shrink-0">
                    {% endif %}
                    <span class="text-lg sm:text-xl lg:text-2xl font-bold text-brand-700 leading-tight max-w-[180px] sm:max-w-[240px] lg:max-w-xs flex-shrink-0">
                        {{ settings.home.SiteSettings.business_name }}
                    </span>
                </a>
            </div>

            {# --- Desktop Navigation Links --- #}
            <div class="hidden lg:flex lg:items-center lg:gap-1 xl:gap-4">
                <a href="/services/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium text-sm xl:text-base whitespace-nowrap px-2 py-1">
                    Services
                </a>
                <a href="/about/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium text-sm xl:text-base whitespace-nowrap px-2 py-1">
                    About Us
                </a>

                {# --- Resources Dropdown --- #}
                <div class="relative" id="resources-dropdown">
                    <a href="/resources/" id="resources-link"
                       class="text-gray-600 hover:text-brand-600 transition font-medium text-sm xl:text-base whitespace-nowrap inline-flex items-center gap-0.5 px-2 py-1">
                        Resources
                        <button type="button" id="resources-toggle" aria-label="Toggle resources menu"
                                class="text-gray-600 hover:text-brand-600 transition focus:outline-none">
                            <svg class="w-4 h-4 transition-transform" id="resources-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                        </button>
                    </a>
                    <div id="resources-menu"
                         class="hidden absolute left-1/2 -translate-x-1/2 top-full mt-2 w-56 bg-white border border-gray-200 rounded-xl shadow-lg py-2 z-50">
                        <a href="/resources/?category=what-is-thermography" class="block px-4 py-2 text-sm text-gray-600 hover:bg-brand-50 hover:text-brand-600 transition">
                            What is Thermography?
                        </a>
                        <a href="/resources/?category=articles" class="block px-4 py-2 text-sm text-gray-600 hover:bg-brand-50 hover:text-brand-600 transition">
                            Articles
                        </a>
                        <a href="/resources/?category=experts" class="block px-4 py-2 text-sm text-gray-600 hover:bg-brand-50 hover:text-brand-600 transition">
                            Meet the Experts
                        </a>
                    </div>
                </div>
                <a href="/your-first-visit/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium text-sm xl:text-base whitespace-nowrap px-2 py-1">
                    First Visit
                </a>
                <a href="/faq/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium text-sm xl:text-base whitespace-nowrap px-2 py-1">
                    FAQ
                </a>
                <a href="/contact/"
                   class="text-gray-600 hover:text-brand-600 transition font-medium text-sm xl:text-base whitespace-nowrap px-2 py-1">
                    Contact
                </a>

                {# --- Search Toggle --- #}
                <button id="search-toggle" aria-label="Search"
                        class="text-gray-600 hover:text-brand-600 transition focus:outline-none px-2">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                </button>

                <a href="/booking/"
                   class="bg-brand-600 text-white px-4 xl:px-5 py-2 rounded-lg hover:bg-brand-700 transition font-medium text-sm xl:text-base whitespace-nowrap ml-2">
                    Book Now
                </a>
            </div>

            {# --- Mobile Hamburger Button --- #}
            <div class="lg:hidden">
                <button id="mobile-menu-button" aria-label="Open menu" class="text-gray-600 hover:text-brand-600 focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    {# --- Mobile Dropdown Overlay (hidden by default) --- #}
    {# Dark backdrop — covers the page behind the dropdown #}
    <div id="mobile-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" aria-hidden="true"></div>

    {# Dropdown panel — slides down from the top #}
    <div id="mobile-menu" class="lg:hidden relative bg-white shadow-xl z-50 overflow-y-auto hidden">
        {# Close button #}
        <div class="flex justify-end px-4 pt-3 pb-1">
            <button id="mobile-menu-close" aria-label="Close menu" class="text-gray-600 hover:text-brand-600 focus:outline-none">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        {# Menu links #}
        <div class="px-6 pb-6 space-y-3">
            {# Mobile search bar #}
            <form action="/search/" method="get" class="relative mb-2">
                <input type="text" name="query" placeholder="Search…"
                       class="w-full border border-gray-300 rounded-lg pl-10 pr-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
            </form>
            <a href="/services/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">Services</a>
            <a href="/about/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">About Us</a>

            {# Mobile Resources expandable #}
            <div>
                <a href="/resources/"
                   class="flex items-center justify-between w-full text-gray-700 hover:text-brand-600 font-medium text-lg py-2">
                    Resources
                    <button type="button" id="mobile-resources-toggle" aria-label="Toggle resources menu"
                            class="text-gray-600 hover:text-brand-600 focus:outline-none p-1">
                        <svg class="w-4 h-4 transition-transform" id="mobile-resources-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                        </svg>
                    </button>
                </a>
                <div id="mobile-resources-menu" class="hidden pl-4 space-y-2 mt-1">
                    <a href="/resources/?category=what-is-thermography" class="block text-gray-600 hover:text-brand-600 text-base py-1">What is Thermography?</a>
                    <a href="/resources/?category=articles" class="block text-gray-600 hover:text-brand-600 text-base py-1">Articles</a>
                    <a href="/resources/?category=experts" class="block text-gray-600 hover:text-brand-600 text-base py-1">Meet the Experts</a>
                </div>
            </div>
            <a href="/your-first-visit/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">Your First Visit</a>
            <a href="/faq/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">FAQ</a>
            <a href="/contact/" class="block text-gray-700 hover:text-brand-600 font-medium text-lg py-2">Contact</a>
            <a href="/booking/" class="block bg-brand-600 text-white text-center px-5 py-3 rounded-lg hover:bg-brand-700 font-medium text-lg mt-3">Book Now</a>
        </div>
    </div>

    {# --- Desktop Search Bar (slides down below navbar) --- #}
    <div id="search-bar" class="hidden bg-white border-t border-gray-100 shadow-md">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <form action="/search/" method="get" class="relative">
                <input type="text" name="query" id="search-input" placeholder="Search services, FAQs, articles…"
                       autocomplete="off"
                       class="w-full border border-gray-300 rounded-lg pl-10 pr-12 py-3 text-gray-700 text-lg
                              focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                <button type="button" id="search-close" aria-label="Close search"
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </form>
        </div>
    </div>
</nav>

{# --- Search Toggle Script --- #}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const toggle = document.getElementById('search-toggle');
    const bar = document.getElementById('search-bar');
    const input = document.getElementById('search-input');
    const closeBtn = document.getElementById('search-close');

    if (!toggle || !bar) return;

    toggle.addEventListener('click', function () {
        bar.classList.toggle('hidden');
        if (!bar.classList.contains('hidden')) {
            input.focus();
        }
    });

    closeBtn.addEventListener('click', function () {
        bar.classList.add('hidden');
        input.value = '';
    });

    // Close on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && !bar.classList.contains('hidden')) {
            bar.classList.add('hidden');
            input.value = '';
        }
    });

    // --- Desktop Resources Dropdown ---
    const rToggle = document.getElementById('resources-toggle');
    const rMenu = document.getElementById('resources-menu');
    const rChevron = document.getElementById('resources-chevron');
    const rDropdown = document.getElementById('resources-dropdown');

    if (rToggle && rMenu) {
        rToggle.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            rMenu.classList.toggle('hidden');
            rChevron.classList.toggle('rotate-180');
        });
        // Close when clicking outside
        document.addEventListener('click', function (e) {
            if (!rDropdown.contains(e.target)) {
                rMenu.classList.add('hidden');
                rChevron.classList.remove('rotate-180');
            }
        });
        // Close on Escape
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                rMenu.classList.add('hidden');
                rChevron.classList.remove('rotate-180');
            }
        });
    }

    // --- Mobile Resources Expandable ---
    const mToggle = document.getElementById('mobile-resources-toggle');
    const mMenu = document.getElementById('mobile-resources-menu');
    const mChevron = document.getElementById('mobile-resources-chevron');

    if (mToggle && mMenu) {
        mToggle.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            mMenu.classList.toggle('hidden');
            mChevron.classList.toggle('rotate-180');
        });
    }
});
</script>